const fs = require('fs');
const path = require('path');

// Define the path to the node_modules folder
const nodeModulesPath = path.join('/home', 'dan', 'Node_Pojects_Linux', 'S3_linux', 'middlewares', 'uploads', 'S3_linux'
    ,'node_modules');

// Middleware function to remove node_modules folder if it exists
const removeNodeModules = (req, res, next) => {
  // Check if the parent directory exists
  const parentDirPath = path.dirname(nodeModulesPath);
  
  if (!fs.existsSync(parentDirPath)) {
    console.log(`The parent directory ${parentDirPath} does not exist.`);
    return next(); // Skip deletion and proceed to the next middleware
  }
  
  // Check if the node_modules directory exists
  if (fs.existsSync(nodeModulesPath)) {
    // Remove the directory and its contents
    fs.rmSync(nodeModulesPath, { recursive: true, force: true });
    console.log(`Deleted ${nodeModulesPath}`);
  } else {
    console.log(`${nodeModulesPath} does not exist.`);
  }
  
  // Proceed to the next middleware
  next();
};

module.exports = removeNodeModules;
